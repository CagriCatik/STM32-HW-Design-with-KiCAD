"use strict";(self.webpackChunkPCB_Design=self.webpackChunkPCB_Design||[]).push([[8713],{6402:(s,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>o,frontMatter:()=>t,metadata:()=>a,toc:()=>h});const a=JSON.parse('{"id":"Schematic/Summary/external_clock","title":"External High-Speed Crystal Oscillator, USB/SWD Routing, and Pin-Out Integration","description":"This documentation provides a complete explanation of the external crystal oscillator subsystem, its load capacitors, grounding strategy, and supporting references. It also integrates the previously defined USB differential pair and SWD debug signals. Together, these additions finalize the electrical infrastructure required for accurate MCU timing, USB full-speed operation, and reliable firmware development with STM32CubeIDE.","source":"@site/docs/02_Schematic/Summary/04_external_clock.md","sourceDirName":"02_Schematic/Summary","slug":"/Schematic/Summary/external_clock","permalink":"/STM32-HW-Design-with-KiCAD/docs/Schematic/Summary/external_clock","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02_Schematic/Summary/04_external_clock.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"SchematicSidebar","previous":{"title":"Pin-Out and STM32CubeIDE","permalink":"/STM32-HW-Design-with-KiCAD/docs/Schematic/Summary/pinout-stm32cube"},"next":{"title":"usb","permalink":"/STM32-HW-Design-with-KiCAD/docs/Schematic/Summary/usb"}}');var i=n(74848),l=n(28453);const r=n.p+"assets/images/external_clock-0c89eee91353eae6023b28a801fdb7f1.png",t={},c="External High-Speed Crystal Oscillator, USB/SWD Routing, and Pin-Out Integration",d={},h=[{value:"External High-Speed Crystal (HSE) Subsystem",id:"external-high-speed-crystal-hse-subsystem",level:2},{value:"Crystal Symbol and Package",id:"crystal-symbol-and-package",level:3},{value:"Microcontroller Oscillator Architecture",id:"microcontroller-oscillator-architecture",level:3},{value:"Schematic Implementation",id:"schematic-implementation",level:3},{value:"Selecting Load Capacitor Values",id:"selecting-load-capacitor-values",level:2},{value:"Crystal Load Capacitance",id:"crystal-load-capacitance",level:3},{value:"Stray Capacitance",id:"stray-capacitance",level:3},{value:"Load Capacitor Formula",id:"load-capacitor-formula",level:3},{value:"Final Selection",id:"final-selection",level:3},{value:"Notes on Optional Series Resistor",id:"notes-on-optional-series-resistor",level:2},{value:"USB Differential Pair Integration",id:"usb-differential-pair-integration",level:2},{value:"SWD Debug Interface Integration",id:"swd-debug-interface-integration",level:2},{value:"Summary of the Added Crystal and Pin-Out Subsystem",id:"summary-of-the-added-crystal-and-pin-out-subsystem",level:2},{value:"External 16 MHz Crystal Oscillator (HSE)",id:"external-16-mhz-crystal-oscillator-hse",level:2},{value:"Y1 (16 MHz Crystal)",id:"y1-16-mhz-crystal",level:3},{value:"C10 and C11 (10 pF Load Capacitors)",id:"c10-and-c11-10-pf-load-capacitors",level:3},{value:"Crystal Ground Reference",id:"crystal-ground-reference",level:3},{value:"USB Differential Pair Labeling",id:"usb-differential-pair-labeling",level:2},{value:"SWD Debug Interface Labeling",id:"swd-debug-interface-labeling",level:2},{value:"Integration Summary",id:"integration-summary",level:2}];function m(s){const e={annotation:"annotation",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",math:"math",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msub:"msub",mtext:"mtext",p:"p",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,l.R)(),...s.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"external-high-speed-crystal-oscillator-usbswd-routing-and-pin-out-integration",children:"External High-Speed Crystal Oscillator, USB/SWD Routing, and Pin-Out Integration"})}),"\n",(0,i.jsx)(e.p,{children:"This documentation provides a complete explanation of the external crystal oscillator subsystem, its load capacitors, grounding strategy, and supporting references. It also integrates the previously defined USB differential pair and SWD debug signals. Together, these additions finalize the electrical infrastructure required for accurate MCU timing, USB full-speed operation, and reliable firmware development with STM32CubeIDE."}),"\n","\n",(0,i.jsx)("div",{style:{textAlign:"center"},children:(0,i.jsx)("img",{src:r,alt:"external_clock",style:{width:"500px"}})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"external-high-speed-crystal-hse-subsystem",children:"External High-Speed Crystal (HSE) Subsystem"}),"\n",(0,i.jsx)(e.h3,{id:"crystal-symbol-and-package",children:"Crystal Symbol and Package"}),"\n",(0,i.jsxs)(e.p,{children:["The added crystal (Y1) uses a ",(0,i.jsx)(e.strong,{children:"four-pin HC49/US or SMD 4-pad package"}),", commonly used for through-hole or low-profile surface-mount crystals."]}),"\n",(0,i.jsx)(e.p,{children:"The pin functions are:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Pins ",(0,i.jsx)(e.strong,{children:"1"})," and ",(0,i.jsx)(e.strong,{children:"3"}),": Crystal terminals (oscillator input/output)."]}),"\n",(0,i.jsxs)(e.li,{children:["Pins ",(0,i.jsx)(e.strong,{children:"2"})," and ",(0,i.jsx)(e.strong,{children:"4"}),": Grounded case pads, connected to GND for shielding and noise reduction."]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"Only pins 1 and 3 participate in the oscillation; pins 2 and 4 mechanically stabilize the package and provide EMI shielding."}),"\n",(0,i.jsx)(e.h3,{id:"microcontroller-oscillator-architecture",children:"Microcontroller Oscillator Architecture"}),"\n",(0,i.jsx)(e.p,{children:"STM32 microcontrollers include the active components internally:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["An ",(0,i.jsx)(e.strong,{children:"inverter amplifier"})," between HSE_IN and HSE_OUT"]}),"\n",(0,i.jsxs)(e.li,{children:["A ",(0,i.jsx)(e.strong,{children:"feedback resistor"})," inside the chip"]}),"\n",(0,i.jsx)(e.li,{children:"Bias and drive-strength control logic"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"External components only need to provide:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"The crystal resonator"}),"\n",(0,i.jsx)(e.li,{children:"Two matched load capacitors"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["This matches ST\u2019s recommended design documented in:\n",(0,i.jsx)(e.strong,{children:"Application Note AN2867 \u2013 \u201cOscillator design guide for STM32 microcontrollers.\u201d"})]}),"\n",(0,i.jsx)(e.h3,{id:"schematic-implementation",children:"Schematic Implementation"}),"\n",(0,i.jsx)(e.p,{children:"The schematic correctly mirrors the recommended topology:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Y1"})," is connected between ",(0,i.jsx)(e.strong,{children:"PD0 (HSE_IN)"})," and ",(0,i.jsx)(e.strong,{children:"PD1 (HSE_OUT)"}),"."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"C10"})," and ",(0,i.jsx)(e.strong,{children:"C11"})," (10 pF each) connect from each crystal pin to ground."]}),"\n",(0,i.jsxs)(e.li,{children:["Pins ",(0,i.jsx)(e.strong,{children:"2"})," and ",(0,i.jsx)(e.strong,{children:"4"})," of the crystal footprint are tied to GND for shielding."]}),"\n",(0,i.jsx)(e.li,{children:"No external series resistor is used (optional; rarely required)."}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"This is the canonical STM32 HSE configuration."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"selecting-load-capacitor-values",children:"Selecting Load Capacitor Values"}),"\n",(0,i.jsx)(e.h3,{id:"crystal-load-capacitance",children:"Crystal Load Capacitance"}),"\n",(0,i.jsx)(e.p,{children:"The selected crystal specifies:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Load capacitance (",(0,i.jsx)(e.strong,{children:"CL"}),") = ",(0,i.jsx)(e.strong,{children:"10 pF"})]}),"\n",(0,i.jsx)(e.li,{children:"Frequency = 16 MHz"}),"\n",(0,i.jsx)(e.li,{children:"Package = 4-pin SMD with grounded shell"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"stray-capacitance",children:"Stray Capacitance"}),"\n",(0,i.jsx)(e.p,{children:"PCB traces and MCU input pins introduce unavoidable stray capacitance, typically:"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"3\u20135 pF total"})," from both sides combined."]}),"\n",(0,i.jsx)(e.h3,{id:"load-capacitor-formula",children:"Load Capacitor Formula"}),"\n",(0,i.jsx)(e.p,{children:"For symmetrical load capacitors:"}),"\n",(0,i.jsx)(e.span,{className:"katex-display",children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"C"}),(0,i.jsx)(e.mtext,{children:"load"})]}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsxs)(e.mfrac,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"C"}),(0,i.jsx)(e.mi,{children:"L"})]}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"C"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mi,{children:"r"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"y"})]})]})]}),(0,i.jsx)(e.mn,{children:"2"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"[\nC_{\\text{load}} = \\frac{C_L - C_{stray}}{2}\n]"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:(0,i.jsx)(e.span,{className:"mord text mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"load"})})})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"2.0463em",verticalAlign:"-0.686em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,i.jsx)(e.span,{className:"mfrac",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.3603em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.314em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord",children:(0,i.jsx)(e.span,{className:"mord",children:"2"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,i.jsxs)(e.span,{style:{top:"-3.677em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3283em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"L"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"s"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.02778em"},children:"r"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"a"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03588em"},children:"y"})]})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.686em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mclose nulldelimiter"})]}),(0,i.jsx)(e.span,{className:"mclose",children:"]"})]})]})]})}),"\n",(0,i.jsx)(e.p,{children:"Using values from the transcript:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"C"}),(0,i.jsx)(e.mi,{children:"L"})]}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsx)(e.mn,{children:"10"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mi,{children:"p"}),(0,i.jsx)(e.mi,{children:"F"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"(C_L = 10) pF"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3283em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"L"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord",children:"10"}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"pF"})]})]})]})}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"C"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mi,{children:"r"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"y"})]})]}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsx)(e.mn,{children:"5"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mi,{children:"p"}),(0,i.jsx)(e.mi,{children:"F"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"(C_{stray} = 5) pF"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.0361em",verticalAlign:"-0.2861em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"s"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.02778em"},children:"r"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"a"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03588em"},children:"y"})]})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord",children:"5"}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"pF"})]})]})]})," (worst-case assumption)"]}),"\n"]}),"\n",(0,i.jsx)(e.span,{className:"katex-display",children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"C"}),(0,i.jsx)(e.mtext,{children:"load"})]}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsxs)(e.mfrac,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mn,{children:"10"}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsx)(e.mn,{children:"5"})]}),(0,i.jsx)(e.mn,{children:"2"})]}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsx)(e.mn,{children:"2.5"}),(0,i.jsx)(e.mtext,{children:"\xa0pF"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"[\nC_{\\text{load}} = \\frac{10 - 5}{2} = 2.5 \\text{ pF}\n]"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:(0,i.jsx)(e.span,{className:"mord text mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"load"})})})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"2.0074em",verticalAlign:"-0.686em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,i.jsx)(e.span,{className:"mfrac",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.3214em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.314em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord",children:(0,i.jsx)(e.span,{className:"mord",children:"2"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,i.jsxs)(e.span,{style:{top:"-3.677em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord",children:"10"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mord",children:"5"})]})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.686em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mclose nulldelimiter"})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord",children:"2.5"}),(0,i.jsx)(e.span,{className:"mord text",children:(0,i.jsx)(e.span,{className:"mord",children:"\xa0pF"})}),(0,i.jsx)(e.span,{className:"mclose",children:"]"})]})]})]})}),"\n",(0,i.jsxs)(e.p,{children:["However, manufacturers assume individual stray capacitance per side, so practical selection doubles that effective value. Designers generally choose ",(0,i.jsx)(e.strong,{children:"8\u201312 pF"})," per capacitor."]}),"\n",(0,i.jsx)(e.h3,{id:"final-selection",children:"Final Selection"}),"\n",(0,i.jsx)(e.p,{children:"The schematic uses:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"C10 = 10 pF"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"C11 = 10 pF"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"These values match:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"The crystal\u2019s load capacitance"}),"\n",(0,i.jsx)(e.li,{children:"The expected PCB parasitics"}),"\n",(0,i.jsx)(e.li,{children:"ST\u2019s recommended values for 8\u201316 MHz crystals"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"This achieves accurate oscillation frequency and reliable startup."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"notes-on-optional-series-resistor",children:"Notes on Optional Series Resistor"}),"\n",(0,i.jsx)(e.p,{children:"Some designs use a series resistor between the crystal and HSE_OUT to limit drive strength.\nThis is only required if:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"The crystal manufacturer specifies a maximum drive level, or"}),"\n",(0,i.jsx)(e.li,{children:"The MCU overdrives the crystal at high temperatures."}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"STM32F103 rarely requires this resistor, so leaving it out is correct."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"usb-differential-pair-integration",children:"USB Differential Pair Integration"}),"\n",(0,i.jsx)(e.p,{children:"The added labels:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"USB_DM \u2192 PA11"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"USB_DP \u2192 PA12"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"define the USB full-speed (12 Mbps) differential signals."}),"\n",(0,i.jsx)(e.p,{children:"KiCad recognizes differential pairs based on naming, enabling:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Controlled impedance routing (\u2248 90 \u03a9 differential)"}),"\n",(0,i.jsx)(e.li,{children:"Matched trace lengths"}),"\n",(0,i.jsx)(e.li,{children:"Automated USB pair routing tools"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"This is essential for USB-C or USB-micro connectors used later in the design."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"swd-debug-interface-integration",children:"SWD Debug Interface Integration"}),"\n",(0,i.jsx)(e.p,{children:"The added SWD pins:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"SWDIO \u2192 PA13"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"SWCLK \u2192 PA14"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"provide the required interface for:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"ST-Link V2"}),"\n",(0,i.jsx)(e.li,{children:"J-Link"}),"\n",(0,i.jsx)(e.li,{children:"PyOCD"}),"\n",(0,i.jsx)(e.li,{children:"OpenOCD"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"These pins must remain free of pull-ups, pull-downs, or alternate assignments."}),"\n",(0,i.jsx)(e.p,{children:"Clear labeling ensures correct wiring to the SWD header during layout."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"summary-of-the-added-crystal-and-pin-out-subsystem",children:"Summary of the Added Crystal and Pin-Out Subsystem"}),"\n",(0,i.jsx)(e.p,{children:"The schematic additions include:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["A ",(0,i.jsx)(e.strong,{children:"16 MHz external crystal"})," connected to PD0/PD1"]}),"\n",(0,i.jsxs)(e.li,{children:["Two ",(0,i.jsx)(e.strong,{children:"10 pF load capacitors"})," that match the crystal\u2019s required load"]}),"\n",(0,i.jsx)(e.li,{children:"Grounded shielding pads for the crystal package"}),"\n",(0,i.jsx)(e.li,{children:"USB differential pair labels for impedance-controlled routing"}),"\n",(0,i.jsx)(e.li,{children:"SWD labels for programming and debugging"}),"\n",(0,i.jsx)(e.li,{children:"A topology consistent with ST\u2019s AN2867 oscillator design guide"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"Together, these components complete the clock generation, USB signaling, and debug infrastructure for the STM32F103C8Tx design."}),"\n",(0,i.jsx)(e.h2,{id:"external-16-mhz-crystal-oscillator-hse",children:"External 16 MHz Crystal Oscillator (HSE)"}),"\n",(0,i.jsxs)(e.p,{children:["The new crystal subsystem is built around a ",(0,i.jsx)(e.strong,{children:"16 MHz parallel-resonant crystal"})," connected to the MCU's high-speed external oscillator pins:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"PD0 \u2192 HSE_IN"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"PD1 \u2192 HSE_OUT"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"These pins are assigned automatically in STM32CubeIDE when the high-speed external clock is enabled."}),"\n",(0,i.jsx)(e.h3,{id:"y1-16-mhz-crystal",children:"Y1 (16 MHz Crystal)"}),"\n",(0,i.jsx)(e.p,{children:"The crystal (Y1) forms the core of the MCU\u2019s primary timing source. At 16 MHz, it provides sufficiently accurate timing for:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"USB full-speed operation"}),"\n",(0,i.jsx)(e.li,{children:"UART/SPI baud-rate precision"}),"\n",(0,i.jsx)(e.li,{children:"Deterministic MCU clocking"}),"\n",(0,i.jsx)(e.li,{children:"Reliable PLL multiplication to system frequencies up to 72 MHz"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"The crystal is connected directly between HSE_IN and HSE_OUT."}),"\n",(0,i.jsx)(e.h3,{id:"c10-and-c11-10-pf-load-capacitors",children:"C10 and C11 (10 pF Load Capacitors)"}),"\n",(0,i.jsx)(e.p,{children:"Two load capacitors (C10 and C11) are connected from each crystal pin to ground."}),"\n",(0,i.jsxs)(e.p,{children:["Their values are tuned to match the crystal's specified load capacitance. Typical values range from ",(0,i.jsx)(e.strong,{children:"10\u201322 pF"}),", depending on PCB trace parasitics and crystal specifications. Here, ",(0,i.jsx)(e.strong,{children:"10 pF"})," provides appropriate loading for most 16 MHz crystals."]}),"\n",(0,i.jsx)(e.p,{children:"These capacitors ensure:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Stable oscillation"}),"\n",(0,i.jsx)(e.li,{children:"Correct frequency accuracy"}),"\n",(0,i.jsx)(e.li,{children:"Consistent startup characteristics"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"crystal-ground-reference",children:"Crystal Ground Reference"}),"\n",(0,i.jsx)(e.p,{children:"The capacitors share a tight, local ground reference near the MCU. Proper placement minimizes loop area and reduces susceptibility to EMI. This matches STMicroelectronics\u2019 recommended oscillator layout guidelines."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"usb-differential-pair-labeling",children:"USB Differential Pair Labeling"}),"\n",(0,i.jsx)(e.p,{children:"Two USB signals have now been properly named:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"PA11 \u2192 USB_DM"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"PA12 \u2192 USB_DP"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"These labels ensure that KiCad recognizes the signals as a matched differential pair when routing to a USB-C connector."}),"\n",(0,i.jsx)(e.p,{children:"Differential naming allows:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Impedance-controlled routing (typically 90 \u03a9 differential)"}),"\n",(0,i.jsx)(e.li,{children:"Pair-length matching"}),"\n",(0,i.jsx)(e.li,{children:"Scribble-free automatic D+/D- pairing during layout"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"This is mandatory for reliable USB 2.0 full-speed signaling."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"swd-debug-interface-labeling",children:"SWD Debug Interface Labeling"}),"\n",(0,i.jsx)(e.p,{children:"Two critical debug pins have been labeled:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"PA13 \u2192 SWDIO"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"PA14 \u2192 SWCLK"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"These signals allow programming and debugging via an ST-Link V2 or similar SWD debugger. Net labels establish a one-to-one correspondence with STM32CubeIDE configuration and prevent accidental reuse of these pins for other functions."}),"\n",(0,i.jsx)(e.p,{children:"Labeling ensures:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Easy routing to a 4-pin SWD header"}),"\n",(0,i.jsx)(e.li,{children:"Guaranteed compatibility with ST-Link tools"}),"\n",(0,i.jsx)(e.li,{children:"Clean separation from general-purpose I/O"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"SWD is preferred over JTAG because it uses fewer pins and is directly supported by the STM32F1 series."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"integration-summary",children:"Integration Summary"}),"\n",(0,i.jsx)(e.p,{children:"The newly added circuitry and labels achieve the following:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Provide a stable 16 MHz clock source with proper load capacitors"}),"\n",(0,i.jsx)(e.li,{children:"Enable USB full-speed operation through correctly named differential signals"}),"\n",(0,i.jsx)(e.li,{children:"Reserve SWDIO/SWCLK for programming and debugging"}),"\n",(0,i.jsx)(e.li,{children:"Maintain exact alignment with STM32CubeIDE pin assignments"}),"\n",(0,i.jsx)(e.li,{children:"Prepare the design for correct routing in KiCad, including differential pairs and oscillator placement"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"These upgrades complete the microcontroller\u2019s foundational hardware, ensuring precise timing, full USB capability, and robust debugging support."})]})}function o(s={}){const{wrapper:e}={...(0,l.R)(),...s.components};return e?(0,i.jsx)(e,{...s,children:(0,i.jsx)(m,{...s})}):m(s)}},28453:(s,e,n)=>{n.d(e,{R:()=>r,x:()=>t});var a=n(96540);const i={},l=a.createContext(i);function r(s){const e=a.useContext(l);return a.useMemo((function(){return"function"==typeof s?s(e):{...e,...s}}),[e,s])}function t(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(i):s.components||i:r(s.components),a.createElement(l.Provider,{value:e},s.children)}}}]);