"use strict";(self.webpackChunkPCB_Design=self.webpackChunkPCB_Design||[]).push([[6037],{23616:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"Schematic/USB","title":"Connecting USB Circuitry","description":"Integrating USB circuitry into an STM32 microcontroller design using KiCad is a critical step for enabling reliable USB communication in your projects. This documentation provides a comprehensive guide covering the addition of a USB connector, configuration of differential pairs, power management, USB detection mechanisms, and adherence to best practices. By following these detailed instructions, you will ensure that your design complies with USB standards and functions effectively in real-world applications.","source":"@site/docs/02_Schematic/05_USB.md","sourceDirName":"02_Schematic","slug":"/Schematic/USB","permalink":"/STM32-HW-Design-with-KiCAD/docs/Schematic/USB","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02_Schematic/05_USB.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"SchematicSidebar","previous":{"title":"Connecting the Crystal Oscillator","permalink":"/STM32-HW-Design-with-KiCAD/docs/Schematic/Crystal-Circuitry"},"next":{"title":"Serial Debug Connectors, Power Supply","permalink":"/STM32-HW-Design-with-KiCAD/docs/Schematic/Power-Supply-Connectors"}}');var l=i(74848),s=i(28453);const r={},c="Connecting USB Circuitry",o={},a=[{value:"1. Adding a USB Connector to the Schematic",id:"1-adding-a-usb-connector-to-the-schematic",level:2},{value:"1.1 Selecting the Appropriate USB Connector",id:"11-selecting-the-appropriate-usb-connector",level:3},{value:"1.2 Step-by-Step Guide to Adding the USB Connector",id:"12-step-by-step-guide-to-adding-the-usb-connector",level:3},{value:"Step 1: Select the USB Connector Symbol",id:"step-1-select-the-usb-connector-symbol",level:4},{value:"Step 2: Understanding USB Pinouts for Device-Only Operation",id:"step-2-understanding-usb-pinouts-for-device-only-operation",level:4},{value:"1.3 Connecting the USB Differential Pair",id:"13-connecting-the-usb-differential-pair",level:3},{value:"1.4 Connecting Power and Ground",id:"14-connecting-power-and-ground",level:3},{value:"1.5 Handling the Shield and ID Pins",id:"15-handling-the-shield-and-id-pins",level:3},{value:"2. Adding the Power Circuit (VBUS)",id:"2-adding-the-power-circuit-vbus",level:2},{value:"2.1 Labeling the VBUS Pin",id:"21-labeling-the-vbus-pin",level:3},{value:"2.2 Implementing Voltage Regulation",id:"22-implementing-voltage-regulation",level:3},{value:"2.3 Power Regulation Summary",id:"23-power-regulation-summary",level:3},{value:"3. Ensuring Proper USB Detection (1.5K Resistor on D+ Line)",id:"3-ensuring-proper-usb-detection-15k-resistor-on-d-line",level:2},{value:"3.1 Step-by-Step Guide to Placing the 1.5K\u03a9 Resistor",id:"31-step-by-step-guide-to-placing-the-15k\u03c9-resistor",level:3},{value:"Step 1: Adding the Resistor Symbol",id:"step-1-adding-the-resistor-symbol",level:4},{value:"Step 2: Connecting the Resistor",id:"step-2-connecting-the-resistor",level:4},{value:"3.2 Importance of the 1.5K\u03a9 Pull-Up Resistor",id:"32-importance-of-the-15k\u03c9-pull-up-resistor",level:3},{value:"3.3 Recap of the Pull-Up Configuration",id:"33-recap-of-the-pull-up-configuration",level:3},{value:"4. Electrical Rule Check (ERC)",id:"4-electrical-rule-check-erc",level:2},{value:"4.1 Adding Do Not Connect (DNC) Flags",id:"41-adding-do-not-connect-dnc-flags",level:3},{value:"4.2 Running the Electrical Rule Check",id:"42-running-the-electrical-rule-check",level:3},{value:"5. Application Notes and Best Practices",id:"5-application-notes-and-best-practices",level:2},{value:"5.1 Reference Documents",id:"51-reference-documents",level:3},{value:"5.2 Termination and Resistor Considerations",id:"52-termination-and-resistor-considerations",level:3},{value:"5.3 PCB Routing Best Practices",id:"53-pcb-routing-best-practices",level:3},{value:"6. Finalizing the USB Circuit in the Schematic",id:"6-finalizing-the-usb-circuit-in-the-schematic",level:2},{value:"6.1 Summary of USB Circuit Components",id:"61-summary-of-usb-circuit-components",level:3},{value:"6.2 Verification Steps",id:"62-verification-steps",level:3},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"connecting-usb-circuitry",children:"Connecting USB Circuitry"})}),"\n",(0,l.jsx)(n.p,{children:"Integrating USB circuitry into an STM32 microcontroller design using KiCad is a critical step for enabling reliable USB communication in your projects. This documentation provides a comprehensive guide covering the addition of a USB connector, configuration of differential pairs, power management, USB detection mechanisms, and adherence to best practices. By following these detailed instructions, you will ensure that your design complies with USB standards and functions effectively in real-world applications."}),"\n",(0,l.jsx)(n.h2,{id:"1-adding-a-usb-connector-to-the-schematic",children:"1. Adding a USB Connector to the Schematic"}),"\n",(0,l.jsx)(n.p,{children:"Integrating a USB connector is the foundational step in enabling USB communication. This section details the process of selecting and placing a USB connector in your schematic, connecting it to the STM32 microcontroller, and handling specific USB pins appropriately."}),"\n",(0,l.jsx)(n.h3,{id:"11-selecting-the-appropriate-usb-connector",children:"1.1 Selecting the Appropriate USB Connector"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"USB Connector Types:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"USB Micro: Commonly used for device-only applications due to its compact size."}),"\n",(0,l.jsx)(n.li,{children:"USB-C: Offers reversible plug orientation and higher power delivery, suitable for more versatile applications."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Example Choice: For this guide, a USB Micro connector is used, but the steps are analogous for USB-C connectors."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"12-step-by-step-guide-to-adding-the-usb-connector",children:"1.2 Step-by-Step Guide to Adding the USB Connector"}),"\n",(0,l.jsx)(n.h4,{id:"step-1-select-the-usb-connector-symbol",children:"Step 1: Select the USB Connector Symbol"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Accessing Symbols:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Open KiCad and navigate to the schematic editor."}),"\n",(0,l.jsx)(n.li,{children:"Click on the Add Symbol tool (typically represented by an op-amp icon or accessible via the toolbar)."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Searching for the USB Symbol:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:'In the Symbol Library dialog, enter "USB" in the search bar.'}),"\n",(0,l.jsx)(n.li,{children:"Locate the USB Micro connector symbol suitable for device-only applications."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Placing the Connector:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Select the USB Micro symbol and place it adjacent to the USB pins of the STM32 microcontroller within your schematic workspace."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"step-2-understanding-usb-pinouts-for-device-only-operation",children:"Step 2: Understanding USB Pinouts for Device-Only Operation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["USB Pin Descriptions:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"V_BUS: Supplies 5V power from the USB host to the device."}),"\n",(0,l.jsx)(n.li,{children:"GND: Common ground reference shared between the USB and the microcontroller."}),"\n",(0,l.jsx)(n.li,{children:"D+ (USB_DP): Positive differential data line."}),"\n",(0,l.jsx)(n.li,{children:"D- (USB_DM): Negative differential data line."}),"\n",(0,l.jsx)(n.li,{children:"ID: Identification pin used for USB On-The-Go (OTG); typically ignored in device-only configurations."}),"\n",(0,l.jsx)(n.li,{children:"Shield: Connected to the physical shield of the USB connector; often left unconnected in device-only designs to prevent ground loops."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"13-connecting-the-usb-differential-pair",children:"1.3 Connecting the USB Differential Pair"}),"\n",(0,l.jsx)(n.p,{children:"Properly routing the differential pair (D+ and D-) is crucial for maintaining signal integrity and complying with USB standards."}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Using the Wiring Tool (W):"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Activate the Wiring Tool by pressing W or selecting it from the toolbar."}),"\n",(0,l.jsx)(n.li,{children:"Connect the D+ (USB_DP) pin of the STM32 to the D+ pin of the USB connector."}),"\n",(0,l.jsx)(n.li,{children:"Similarly, connect the D- (USB_DM) pin of the STM32 to the D- pin of the USB connector."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Naming the Differential Pair:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Assign net labels such as USB_DP and USB_DM to the respective differential lines. This practice aids in organized routing and clarity during PCB layout."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"14-connecting-power-and-ground",children:"1.4 Connecting Power and Ground"}),"\n",(0,l.jsx)(n.p,{children:"Ensuring proper power distribution and grounding is essential for stable USB operation."}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Connecting V_BUS:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Link the V_BUS pin of the USB connector to the VBUS net in your schematic."}),"\n",(0,l.jsx)(n.li,{children:"This connection will later feed into a voltage regulator to supply the appropriate voltage to the STM32."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Connecting GND:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Connect the GND pin of the USB connector directly to the main ground (GND) plane of your circuit."}),"\n",(0,l.jsx)(n.li,{children:"A solid ground connection helps in minimizing noise and ensuring reliable communication."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"15-handling-the-shield-and-id-pins",children:"1.5 Handling the Shield and ID Pins"}),"\n",(0,l.jsx)(n.p,{children:"Properly managing unused pins prevents unintended issues during PCB design and operation."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Shield Pin:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"In device-only designs, the Shield pin is typically left unconnected to avoid creating ground loops."}),"\n",(0,l.jsxs)(n.li,{children:["To indicate that the pin is intentionally unused, apply a Do Not Connect (DNC) flag:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Select the Shield pin."}),"\n",(0,l.jsx)(n.li,{children:"Press Q to assign the DNC property."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"ID Pin:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The ID pin is utilized in USB OTG configurations to switch roles between host and device."}),"\n",(0,l.jsxs)(n.li,{children:["In a device-only setup, this pin is irrelevant and should also be marked as DNC:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Select the ID pin."}),"\n",(0,l.jsx)(n.li,{children:"Press Q to assign the DNC property."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"2-adding-the-power-circuit-vbus",children:"2. Adding the Power Circuit (VBUS)"}),"\n",(0,l.jsx)(n.p,{children:"The USB VBUS provides the necessary power to the device, but since the STM32 operates at 3.3V, a voltage regulation mechanism is required to step down the voltage from 5V to 3.3V."}),"\n",(0,l.jsx)(n.h3,{id:"21-labeling-the-vbus-pin",children:"2.1 Labeling the VBUS Pin"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Using the Power Port Tool:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Activate the Power Port Tool from the schematic editor toolbar."}),"\n",(0,l.jsx)(n.li,{children:"Place a power port symbol and label it as VBUS."}),"\n",(0,l.jsx)(n.li,{children:"Connect this port to the V_BUS pin of the USB connector."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Purpose:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The VBUS net will supply power to both the voltage regulator and any other 5V-powered components in the design."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"22-implementing-voltage-regulation",children:"2.2 Implementing Voltage Regulation"}),"\n",(0,l.jsx)(n.p,{children:"A voltage regulator is essential to provide a stable 3.3V supply to the STM32 microcontroller from the 5V VBUS."}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Selecting the Voltage Regulator:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"A common choice is the AMS1117-3.3V, which efficiently steps down 5V to 3.3V."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Placing the Regulator in the Schematic:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Click on Add Symbol and search for AMS1117 or your chosen regulator."}),"\n",(0,l.jsx)(n.li,{children:"Place the regulator near the USB connector symbol for logical proximity."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Connecting the Regulator:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Input Pin: Connect to the VBUS net (5V)."}),"\n",(0,l.jsx)(n.li,{children:"Ground Pin: Connect to the main ground (GND)."}),"\n",(0,l.jsx)(n.li,{children:"Output Pin: Connect to the 3.3V power rail that supplies the STM32 microcontroller."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Adding Decoupling Capacitors (Best Practice):"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Place capacitors close to the input and output of the voltage regulator to stabilize voltage and filter out noise."}),"\n",(0,l.jsxs)(n.li,{children:["Recommended Values:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Input Capacitor: 10\xb5F electrolytic."}),"\n",(0,l.jsx)(n.li,{children:"Output Capacitor: 10\xb5F electrolytic."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Connect these capacitors between the respective regulator pins and GND."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"23-power-regulation-summary",children:"2.3 Power Regulation Summary"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Flow of Power:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"VBUS (5V) \u2192 Voltage Regulator (AMS1117-3.3V) \u2192 3.3V supply for the STM32 microcontroller."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"3-ensuring-proper-usb-detection-15k-resistor-on-d-line",children:"3. Ensuring Proper USB Detection (1.5K Resistor on D+ Line)"}),"\n",(0,l.jsx)(n.p,{children:"For a USB 2.0 full-speed device, it is imperative to signal to the host that the device is ready for communication. This is achieved by pulling up the D+ (USB_DP) line with a 1.5K\u03a9 resistor."}),"\n",(0,l.jsx)(n.h3,{id:"31-step-by-step-guide-to-placing-the-15k\u03c9-resistor",children:"3.1 Step-by-Step Guide to Placing the 1.5K\u03a9 Resistor"}),"\n",(0,l.jsx)(n.h4,{id:"step-1-adding-the-resistor-symbol",children:"Step 1: Adding the Resistor Symbol"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Accessing the Resistor Symbol:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Click on Add Symbol in the schematic editor."}),"\n",(0,l.jsx)(n.li,{children:'Search for "resistor" in the symbol library.'}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Placing the Resistor:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Place the resistor between the D+ (USB_DP) line and the 3.3V power rail in your schematic workspace."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Labeling the Resistor:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Assign a value label of 1K5 to represent 1.5K\u03a9."}),"\n",(0,l.jsx)(n.li,{children:"This labeling follows standard resistor value notation conventions."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"step-2-connecting-the-resistor",children:"Step 2: Connecting the Resistor"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Connection Points:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"One Terminal: Connect to the USB_DP line."}),"\n",(0,l.jsx)(n.li,{children:"Other Terminal: Connect to the 3.3V power rail."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Net Labeling:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Ensure that the resistor is properly connected within the USB_DP net to maintain signal integrity."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"32-importance-of-the-15k\u03c9-pull-up-resistor",children:"3.2 Importance of the 1.5K\u03a9 Pull-Up Resistor"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Function:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The resistor pulls the D+ line to a high voltage (between 3.0V and 3.6V), signaling to the USB host that the device is a full-speed USB 2.0 device."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Consequences of Omission:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Without this resistor, the host may not recognize the device, leading to communication failures."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"33-recap-of-the-pull-up-configuration",children:"3.3 Recap of the Pull-Up Configuration"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Configuration:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"1.5K\u03a9 Resistor between D+ (USB_DP) and 3.3V."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Result:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Ensures compliance with USB 2.0 full-speed device detection protocols."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"4-electrical-rule-check-erc",children:"4. Electrical Rule Check (ERC)"}),"\n",(0,l.jsx)(n.p,{children:"Performing an Electrical Rule Check is essential to validate your schematic for potential errors before proceeding to PCB layout. ERC helps identify issues such as unconnected pins, incorrect net connections, and other schematic inconsistencies."}),"\n",(0,l.jsx)(n.h3,{id:"41-adding-do-not-connect-dnc-flags",children:"4.1 Adding Do Not Connect (DNC) Flags"}),"\n",(0,l.jsx)(n.p,{children:"Properly flagging unused pins prevents ERC from raising unnecessary warnings, ensuring a smooth verification process."}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Shield and ID Pins:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Both the Shield and ID pins on the USB connector are unused in device-only configurations."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Applying DNC Flags:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Select the Pin: Click on the Shield or ID pin in the schematic."}),"\n",(0,l.jsx)(n.li,{children:"Assign DNC: Press Q to toggle the Do Not Connect property, effectively flagging the pin as intentionally unconnected."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Verification:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Confirm that the DNC flags are visibly present on the schematic symbols of the respective pins."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"42-running-the-electrical-rule-check",children:"4.2 Running the Electrical Rule Check"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Accessing ERC:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Navigate to Tools > Electrical Rules Checker in the KiCad schematic editor."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Executing ERC:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Click on Run to initiate the check."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Reviewing ERC Results:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"No Errors: Ensure that no errors are reported, particularly those related to the USB connections."}),"\n",(0,l.jsx)(n.li,{children:"Warnings: Address any warnings that may arise, ensuring they do not pertain to critical connections or configurations."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Special Consideration:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"The presence of the 1.5K\u03a9 pull-up resistor on the D+ line is vital for meeting USB 2.0 specifications. ERC should verify this connection without issues."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"5-application-notes-and-best-practices",children:"5. Application Notes and Best Practices"}),"\n",(0,l.jsx)(n.p,{children:"Adhering to established guidelines and best practices ensures the reliability and performance of your USB-integrated STM32 design. This section references key documents and outlines essential considerations for termination and resistor configurations."}),"\n",(0,l.jsx)(n.h3,{id:"51-reference-documents",children:"5.1 Reference Documents"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"AN4879: USB Hardware and PCB Guidelines for STM32 Microcontrollers:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Content: Detailed instructions on USB circuitry integration, including pull-up resistor requirements and PCB routing strategies."}),"\n",(0,l.jsx)(n.li,{children:"Usage: Essential for understanding the hardware nuances specific to STM32 USB implementations."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"AN2867: Oscillator Design for STM32:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Content: Guidance on designing external clock sources, particularly relevant if incorporating a crystal oscillator alongside USB."}),"\n",(0,l.jsx)(n.li,{children:"Usage: Provides insights into maintaining accurate timing for USB communication."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"52-termination-and-resistor-considerations",children:"5.2 Termination and Resistor Considerations"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Pull-Up Resistors:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Necessity: Critical for signaling to the USB host the device's operational speed."}),"\n",(0,l.jsxs)(n.li,{children:["Specifics:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"STM32 F1 and F3 Series: Require an external 1.5K\u03a9 pull-up resistor on the D+ line."}),"\n",(0,l.jsx)(n.li,{children:"Higher-End STM32 Series: May feature internal pull-ups, potentially eliminating the need for external resistors."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Design Strategy:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Refer to Datasheets: Always consult the specific STM32 microcontroller's datasheet and relevant application notes to determine the exact resistor requirements."}),"\n",(0,l.jsx)(n.li,{children:"Consistency: Ensure that resistor values and placements align with manufacturer recommendations to avoid communication issues."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"53-pcb-routing-best-practices",children:"5.3 PCB Routing Best Practices"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Differential Pair Routing:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Maintain equal trace lengths for D+ and D- lines to preserve signal integrity."}),"\n",(0,l.jsx)(n.li,{children:"Avoid sharp bends and ensure that the differential pair is routed with controlled impedance."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Ground Planes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Utilize solid ground planes to minimize electromagnetic interference (EMI) and provide a stable reference for USB signals."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Decoupling Capacitors:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Place decoupling capacitors close to the microcontroller's power pins to filter out noise and stabilize voltage levels."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"6-finalizing-the-usb-circuit-in-the-schematic",children:"6. Finalizing the USB Circuit in the Schematic"}),"\n",(0,l.jsx)(n.p,{children:"At this juncture, your USB circuitry should be fully integrated into the schematic, encompassing the USB connector, power management, differential pair configuration, and necessary pull-up resistors. This section recaps the essential components and connections to ensure completeness."}),"\n",(0,l.jsx)(n.h3,{id:"61-summary-of-usb-circuit-components",children:"6.1 Summary of USB Circuit Components"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"USB Connector:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Type: USB Micro or USB-C."}),"\n",(0,l.jsx)(n.li,{children:"Connections: D+, D-, V_BUS, GND, with Shield and ID marked as DNC."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"VBUS Power Supply:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Source: V_BUS (5V) from USB."}),"\n",(0,l.jsx)(n.li,{children:"Regulation: Voltage Regulator (AMS1117-3.3V) steps down to 3.3V for STM32."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Differential Pair:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"D+ (USB_DP) and D- (USB_DM) connected to STM32."}),"\n",(0,l.jsx)(n.li,{children:"Properly routed with equal lengths and labeled nets."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"1.5K\u03a9 Pull-Up Resistor:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Placed between D+ (USB_DP) and 3.3V."}),"\n",(0,l.jsx)(n.li,{children:"Ensures detection as a USB 2.0 full-speed device."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Grounding:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"GND connected to USB and microcontroller ground planes."}),"\n",(0,l.jsx)(n.li,{children:"Shield and ID pins marked as DNC to prevent unintended connections."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"62-verification-steps",children:"6.2 Verification Steps"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Electrical Rule Check (ERC):"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Confirm that no errors are present, particularly regarding USB connections."}),"\n",(0,l.jsx)(n.li,{children:"Ensure that DNC flags are correctly applied to unused pins."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Component Placement Review:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Verify that all components, especially the voltage regulator and pull-up resistor, are appropriately placed and connected."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Net Integrity:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Ensure that all nets (e.g., USB_DP, USB_DM, VBUS) are correctly labeled and interconnected without conflicts."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Compliance with Standards:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Double-check that the schematic adheres to USB 2.0 specifications, particularly regarding signal levels and resistor values."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,l.jsx)(n.p,{children:"By meticulously following this guide, you have successfully integrated USB circuitry into your STM32 microcontroller design using KiCad. The schematic now includes a properly connected USB connector, regulated power supply, correctly routed differential pairs, and the necessary pull-up resistor for USB detection. Adhering to best practices and referencing key application notes ensures that your design is both reliable and compliant with USB standards. Before advancing to PCB layout, always perform thorough verification through an Electrical Rule Check to catch and rectify any potential issues. With this setup, your STM32-based device is well-equipped for robust USB communication, facilitating programming, data transfer, and a wide array of USB-dependent functionalities."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var t=i(96540);const l={},s=t.createContext(l);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);