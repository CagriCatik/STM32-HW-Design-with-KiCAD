<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Schematic/Crystal-Circuitry" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Connecting the Crystal Oscillator | STM32 Hardware Design with KiCAD</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://CagriCatik.github.io/STM32-HW-Design-with-KiCAD/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://CagriCatik.github.io/STM32-HW-Design-with-KiCAD/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://CagriCatik.github.io/STM32-HW-Design-with-KiCAD/docs/Schematic/Crystal-Circuitry"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Connecting the Crystal Oscillator | STM32 Hardware Design with KiCAD"><meta data-rh="true" name="description" content="Integrating a crystal oscillator  into your STM32 microcontroller circuit is a pivotal step in ensuring accurate timing, especially for high-speed communication protocols such as USB, CAN, and UART."><meta data-rh="true" property="og:description" content="Integrating a crystal oscillator  into your STM32 microcontroller circuit is a pivotal step in ensuring accurate timing, especially for high-speed communication protocols such as USB, CAN, and UART."><link data-rh="true" rel="icon" href="/STM32-HW-Design-with-KiCAD/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://CagriCatik.github.io/STM32-HW-Design-with-KiCAD/docs/Schematic/Crystal-Circuitry"><link data-rh="true" rel="alternate" href="https://CagriCatik.github.io/STM32-HW-Design-with-KiCAD/docs/Schematic/Crystal-Circuitry" hreflang="en"><link data-rh="true" rel="alternate" href="https://CagriCatik.github.io/STM32-HW-Design-with-KiCAD/docs/Schematic/Crystal-Circuitry" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Connecting the Crystal Oscillator","item":"https://CagriCatik.github.io/STM32-HW-Design-with-KiCAD/docs/Schematic/Crystal-Circuitry"}]}</script><link rel="alternate" type="application/rss+xml" href="/STM32-HW-Design-with-KiCAD/blog/rss.xml" title="STM32 Hardware Design with KiCAD RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/STM32-HW-Design-with-KiCAD/blog/atom.xml" title="STM32 Hardware Design with KiCAD Atom Feed">






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-d6UvP8MjG/jrWTLxz4ph1bEXHVNyMYAx4GqeFPYYR5tWLm4XAoVRSaSejzE/sFs9" crossorigin="anonymous"><link rel="stylesheet" href="/STM32-HW-Design-with-KiCAD/assets/css/styles.cc534fa5.css">
<script src="/STM32-HW-Design-with-KiCAD/assets/js/runtime~main.607fb828.js" defer="defer"></script>
<script src="/STM32-HW-Design-with-KiCAD/assets/js/main.dfe735fd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/STM32-HW-Design-with-KiCAD/"><div class="navbar__logo"><img src="/STM32-HW-Design-with-KiCAD/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/STM32-HW-Design-with-KiCAD/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/STM32-HW-Design-with-KiCAD/docs/Introduction/">Introduction</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/STM32_uC_Decoupling">Schematics</a><a class="navbar__item navbar__link" href="/STM32-HW-Design-with-KiCAD/docs/PCB_Layout/KiCad_PCB-Setup">Layout</a><a class="navbar__item navbar__link" href="/STM32-HW-Design-with-KiCAD/docs/PCB_Routing/Decoupling-Capacitors-Cyrstal-Routing">Routing</a><a class="navbar__item navbar__link" href="/STM32-HW-Design-with-KiCAD/docs/Manufacturing/Generating-BOM">Manufacturing</a><a class="navbar__item navbar__link" href="/STM32-HW-Design-with-KiCAD/docs/Scripts/Automated_Design">Scripts</a><a class="navbar__item navbar__link" href="/STM32-HW-Design-with-KiCAD/docs/Glossary/A">Glossary</a><a class="navbar__item navbar__link" href="/STM32-HW-Design-with-KiCAD/docs/Recipes/simplify-complex-components">Recipes</a><a class="navbar__item navbar__link" href="/STM32-HW-Design-with-KiCAD/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/CagriCatik/STM32-HW-Design-with-KiCAD" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/STM32_uC_Decoupling"><span title="Decoupling" class="linkLabel_WmDU">Decoupling</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/STM32_Configuration_Pins"><span title="Boot Configuration, Reset Circuit, and Power Source Setup" class="linkLabel_WmDU">Boot Configuration, Reset Circuit, and Power Source Setup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/Pin-Out_STM32CubeIDE"><span title="Pinout Configuration and Peripheral Setup" class="linkLabel_WmDU">Pinout Configuration and Peripheral Setup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/Crystal-Circuitry"><span title="Connecting the Crystal Oscillator" class="linkLabel_WmDU">Connecting the Crystal Oscillator</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/USB"><span title="Connecting USB Circuitry" class="linkLabel_WmDU">Connecting USB Circuitry</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/Power-Supply-Connectors"><span title="Serial Debug Connectors, Power Supply" class="linkLabel_WmDU">Serial Debug Connectors, Power Supply</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/ERC-Annotation"><span title="Sectioning and Annotating" class="linkLabel_WmDU">Sectioning and Annotating</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/Footprint-Assignment"><span title="Assigning Footprints to Schematic Symbols" class="linkLabel_WmDU">Assigning Footprints to Schematic Symbols</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/Final-Schematic"><span title="Schematic" class="linkLabel_WmDU">Schematic</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/Summary/power_decoupling_network"><span title="Summary" class="categoryLinkLabel_W154">Summary</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/STM32-HW-Design-with-KiCAD/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Connecting the Crystal Oscillator</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Connecting the Crystal Oscillator</h1></header>
<p>Integrating a <code>crystal oscillator</code>  into your STM32 microcontroller circuit is a pivotal step in ensuring accurate timing, especially for high-speed communication protocols such as USB, CAN, and UART.</p>
<p>A <code>crystal oscillator</code> is a tiny electronic part that keeps time for a circuit. Inside it is a piece of quartz. Quartz has a useful property called the piezoelectric effect, which means it vibrates when you apply electricity. These vibrations happen at a very precise frequency, so the crystal can act like a super-accurate clock.</p>
<blockquote>
<p>In microcontrollers such as STM32, the crystal and two load capacitors form part of the external high speed oscillator (HSE). The internal amplifier in the MCU drives the crystal. This configuration yields a precise reference clock used for peripherals that need tight timing tolerance, such as USB (48 MHz domain), CAN, high baud UART, and accurate system time.</p>
</blockquote>
<p>A schematic typically includes the crystal between <code>OSC_IN</code> and <code>OSC_OUT</code> pins, two capacitors referenced to ground sized to match the crystal load capacitance specification, a short symmetric layout, and a protective series resistor if needed for drive-level control. The board layout must minimize stray capacitance and loop area to maintain frequency accuracy and startup robustness.</p>
<p>This following part provides a guide on designing and implementing a <code>crystal oscillator</code> circuit using KiCad, covering fundamental principles, component selection, schematic design, and best practices.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-role-of-the-crystal-oscillator-in-stm32-microcontrollers">The Role of the Crystal Oscillator in STM32 Microcontrollers<a href="#the-role-of-the-crystal-oscillator-in-stm32-microcontrollers" class="hash-link" aria-label="Direct link to The Role of the Crystal Oscillator in STM32 Microcontrollers" title="Direct link to The Role of the Crystal Oscillator in STM32 Microcontrollers" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="importance-of-a-precise-clock-source">Importance of a Precise Clock Source<a href="#importance-of-a-precise-clock-source" class="hash-link" aria-label="Direct link to Importance of a Precise Clock Source" title="Direct link to Importance of a Precise Clock Source" translate="no">​</a></h3>
<ul>
<li class=""><strong>Accurate Timing</strong>: Critical for the reliable operation of microcontrollers, especially in applications involving high-speed data transmission.</li>
<li class=""><strong>Stable Communication Protocols</strong>: Ensures consistency and reduces errors in protocols like USB, CAN, and UART.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="internal-vs-external-oscillators">Internal vs. External Oscillators<a href="#internal-vs-external-oscillators" class="hash-link" aria-label="Direct link to Internal vs. External Oscillators" title="Direct link to Internal vs. External Oscillators" translate="no">​</a></h3>
<ul>
<li class=""><strong>Internal Oscillator</strong>:<!-- -->
<ul>
<li class="">Advantages: Simplifies the design by reducing external components.</li>
<li class="">Disadvantages: Generally less accurate and stable, unsuitable for timing-critical applications.</li>
</ul>
</li>
<li class=""><strong>High-Speed External (HSE) Clock</strong>:<!-- -->
<ul>
<li class="">Advantages: Provides higher accuracy and stability.</li>
<li class="">Implementation: Utilizes a <code>crystal oscillator</code>  connected to the HSE pins (OSC_IN and OSC_OUT) on the STM32 microcontroller.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="typical-crystal-oscillator-circuit-components">Typical Crystal Oscillator Circuit Components<a href="#typical-crystal-oscillator-circuit-components" class="hash-link" aria-label="Direct link to Typical Crystal Oscillator Circuit Components" title="Direct link to Typical Crystal Oscillator Circuit Components" translate="no">​</a></h3>
<ul>
<li class=""><strong>Crystal</strong>: Typically a 16 MHz component connected between OSC_IN and OSC_OUT.</li>
<li class=""><strong>Load Capacitors</strong>: Stabilize the oscillation frequency, ensuring accurate timing.</li>
<li class=""><strong>Optional Feedback Resistors</strong>: May be used for controlling signal distortion.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-crystal-package-types-and-symbol-selection-in-kicad">2. Crystal Package Types and Symbol Selection in KiCad<a href="#2-crystal-package-types-and-symbol-selection-in-kicad" class="hash-link" aria-label="Direct link to 2. Crystal Package Types and Symbol Selection in KiCad" title="Direct link to 2. Crystal Package Types and Symbol Selection in KiCad" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="crystal-oscillator-package-configurations">Crystal Oscillator Package Configurations<a href="#crystal-oscillator-package-configurations" class="hash-link" aria-label="Direct link to Crystal Oscillator Package Configurations" title="Direct link to Crystal Oscillator Package Configurations" translate="no">​</a></h3>
<ul>
<li class=""><strong>Two-Pin Configuration</strong>:<!-- -->
<ul>
<li class=""><strong>Common Usage</strong>: Widely used due to simplicity.</li>
<li class=""><strong>Applications</strong>: Suitable for most standard <code>crystal oscillator</code>  requirements.</li>
</ul>
</li>
<li class=""><strong>Four-Pin Configuration</strong>:<!-- -->
<ul>
<li class=""><strong>Enhanced Stability</strong>: Grounding additional pins can improve signal stability and reduce electromagnetic interference (EMI).</li>
<li class=""><strong>Use Case</strong>: Preferred in environments where noise reduction is critical.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="selecting-the-crystal-symbol-in-kicad">Selecting the Crystal Symbol in KiCad<a href="#selecting-the-crystal-symbol-in-kicad" class="hash-link" aria-label="Direct link to Selecting the Crystal Symbol in KiCad" title="Direct link to Selecting the Crystal Symbol in KiCad" translate="no">​</a></h3>
<ol>
<li class=""><strong>Accessing Symbols</strong>:<!-- -->
<ul>
<li class="">Navigate to the Add Symbol tool within KiCad’s schematic editor.</li>
</ul>
</li>
<li class=""><strong>Searching for Crystal Symbols</strong>:<!-- -->
<ul>
<li class="">Enter &quot;Crystal&quot; in the symbol library search bar.</li>
</ul>
</li>
<li class=""><strong>Choosing the Appropriate Symbol</strong>:<!-- -->
<ul>
<li class=""><strong>Two-Pin Crystal</strong>: Select for simpler designs.</li>
<li class=""><strong>Four-Pin Crystal</strong>: Opt for enhanced stability and noise reduction.</li>
</ul>
</li>
<li class=""><strong>Placing the Symbol</strong>:<!-- -->
<ul>
<li class="">Position the crystal symbol near the <code>HSE_IN</code> and <code>HSE_OUT</code> pins of the STM32 microcontroller on the schematic for logical layout and ease of routing.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pin-configuration-for-a-four-pin-crystal">Pin Configuration for a Four-Pin Crystal<a href="#pin-configuration-for-a-four-pin-crystal" class="hash-link" aria-label="Direct link to Pin Configuration for a Four-Pin Crystal" title="Direct link to Pin Configuration for a Four-Pin Crystal" translate="no">​</a></h3>
<ul>
<li class=""><strong>Pins 1 and 3:</strong>
<ul>
<li class="">Function: Connect to <code>HSE_IN</code> (OSC_IN) and <code>HSE_OUT</code> (OSC_OUT) on the STM32.</li>
</ul>
</li>
<li class=""><strong>Pins 2 and 4:</strong>
<ul>
<li class="">Function: Grounded to enhance stability and minimize electromagnetic interference.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-the-crystal-circuit-design">Understanding the Crystal Circuit Design<a href="#understanding-the-crystal-circuit-design" class="hash-link" aria-label="Direct link to Understanding the Crystal Circuit Design" title="Direct link to Understanding the Crystal Circuit Design" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="built-in-microcontroller-features">Built-in Microcontroller Features<a href="#built-in-microcontroller-features" class="hash-link" aria-label="Direct link to Built-in Microcontroller Features" title="Direct link to Built-in Microcontroller Features" translate="no">​</a></h3>
<ul>
<li class=""><strong>Inverters and Feedback Resistors</strong>:<!-- -->
<ul>
<li class="">Integrated into the STM32, these components assist in forming a stable oscillation circuit.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-components-required">External Components Required<a href="#external-components-required" class="hash-link" aria-label="Direct link to External Components Required" title="Direct link to External Components Required" translate="no">​</a></h3>
<ul>
<li class=""><strong>Load Capacitors</strong>:<!-- -->
<ul>
<li class="">Purpose: Stabilize the oscillation frequency.</li>
<li class="">Selection Criteria: Based on crystal load capacitance and PCB stray capacitance.</li>
</ul>
</li>
<li class=""><strong>Optional Feedback Resistors</strong>:<!-- -->
<ul>
<li class="">Function: Limit signal distortion.</li>
<li class="">Consideration: Often omitted unless specific distortion control is required.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="typical-crystal-oscillator-circuit-layout">Typical Crystal Oscillator Circuit Layout<a href="#typical-crystal-oscillator-circuit-layout" class="hash-link" aria-label="Direct link to Typical Crystal Oscillator Circuit Layout" title="Direct link to Typical Crystal Oscillator Circuit Layout" translate="no">​</a></h3>
<ul>
<li class=""><strong>Crystal Connection</strong>:<!-- -->
<ul>
<li class="">Between <code>HSE_IN</code> (PD0) and <code>HSE_OUT</code> (PD1) pins of the STM32.</li>
</ul>
</li>
<li class=""><strong>Load Capacitors</strong>:<!-- -->
<ul>
<li class="">Two identical capacitors connected from each crystal pin to ground.</li>
</ul>
</li>
<li class=""><strong>Feedback Resistor</strong>:<!-- -->
<ul>
<li class="">Optional series resistor connected to manage signal integrity.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-components-load-capacitors">External Components: Load Capacitors<a href="#external-components-load-capacitors" class="hash-link" aria-label="Direct link to External Components: Load Capacitors" title="Direct link to External Components: Load Capacitors" translate="no">​</a></h3>
<ul>
<li class=""><strong>Role in Oscillation</strong>:<!-- -->
<ul>
<li class="">Ensure the crystal oscillates at its designated frequency by providing necessary capacitive loading.</li>
</ul>
</li>
<li class=""><strong>Determining Capacitor Values</strong>:<!-- -->
<ul>
<li class="">Based on the crystal’s specified load capacitance and the PCB’s stray capacitance.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-application-note-an2867-oscillator-design-for-stm32">4. Application Note AN2867: Oscillator Design for STM32<a href="#4-application-note-an2867-oscillator-design-for-stm32" class="hash-link" aria-label="Direct link to 4. Application Note AN2867: Oscillator Design for STM32" title="Direct link to 4. Application Note AN2867: Oscillator Design for STM32" translate="no">​</a></h2>
<p>STMicroelectronics&#x27; Application Note AN2867 serves as an essential reference for designing reliable <code>crystal oscillator</code>  circuits for STM32 microcontrollers.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-guidelines-from-an2867">Key Guidelines from AN2867<a href="#key-guidelines-from-an2867" class="hash-link" aria-label="Direct link to Key Guidelines from AN2867" title="Direct link to Key Guidelines from AN2867" translate="no">​</a></h3>
<ol>
<li class="">Crystal Load Capacitors:<!-- -->
<ul>
<li class="">Critical for stabilizing oscillation.</li>
<li class="">Work in conjunction with the STM32&#x27;s internal oscillator circuitry to generate a stable clock signal.</li>
</ul>
</li>
<li class="">Stray Capacitance Considerations:<!-- -->
<ul>
<li class="">Arises from PCB traces and nearby components.</li>
<li class="">Typically ranges between 3-5 pF.</li>
<li class="">Must be accounted for when calculating load capacitor values.</li>
</ul>
</li>
<li class="">Feedback Resistor Usage:<!-- -->
<ul>
<li class="">Generally optional.</li>
<li class="">May be included to prevent overdriving the crystal and reduce distortion.</li>
<li class="">Many designs operate effectively without it, simplifying the circuit.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h3>
<ul>
<li class=""><strong>Adherence to Guidelines</strong>:<!-- -->
<ul>
<li class="">Following AN2867 ensures reliable oscillator performance and minimizes design errors.</li>
</ul>
</li>
<li class=""><strong>Component Selection</strong>:<!-- -->
<ul>
<li class="">Carefully choose capacitors and resistors based on the application requirements and guidelines provided.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-calculating-the-load-capacitor-values">5. Calculating the Load Capacitor Values<a href="#5-calculating-the-load-capacitor-values" class="hash-link" aria-label="Direct link to 5. Calculating the Load Capacitor Values" title="Direct link to 5. Calculating the Load Capacitor Values" translate="no">​</a></h2>
<p>Accurate calculation of load capacitors is essential for ensuring the crystal oscillates at the desired frequency.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="load-capacitor-calculation-formula">Load Capacitor Calculation Formula<a href="#load-capacitor-calculation-formula" class="hash-link" aria-label="Direct link to Load Capacitor Calculation Formula" title="Direct link to Load Capacitor Calculation Formula" translate="no">​</a></h3>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>C</mi><mrow><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>r</mi><mi>y</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>−</mo><msub><mi>C</mi><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>y</mi></mrow></msub></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">C_{load} = \frac{C_{crystal} - C_{stray}}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">crys</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<ul>
<li class="">C_crystal: Load capacitance specified in the crystal&#x27;s datasheet (typically 10-20 pF).</li>
<li class="">C_stray: Estimated stray capacitance from the PCB (typically 3-5 pF).</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-calculation">Example Calculation<a href="#example-calculation" class="hash-link" aria-label="Direct link to Example Calculation" title="Direct link to Example Calculation" translate="no">​</a></h3>
<p>Given:</p>
<ul>
<li class="">Crystal Load Capacitance (C_crystal): 10 pF</li>
<li class="">Stray Capacitance (C_stray): 5 pF</li>
</ul>
<p>Calculation:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>C</mi><mrow><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi></mrow></msub><mo>=</mo><mfrac><mrow><mn>10</mn><mtext> </mtext><mtext>pF</mtext><mo>−</mo><mn>5</mn><mtext> </mtext><mtext>pF</mtext></mrow><mn>2</mn></mfrac><mo>=</mo><mn>2.5</mn><mtext> </mtext><mtext>pF</mtext></mrow><annotation encoding="application/x-tex">C_{load} = \frac{10 \, \text{pF} - 5 \, \text{pF}}{2} = 2.5 \, \text{pF}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">10</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord text"><span class="mord">pF</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord text"><span class="mord">pF</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord">2.5</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord text"><span class="mord">pF</span></span></span></span></span></span>
<p>Implementation:</p>
<ul>
<li class="">Use two 2.5 pF capacitors connected from each crystal pin to ground.</li>
<li class="">Alternatively, if 2.5 pF capacitors are not readily available, use the nearest standard value (e.g., 3 pF) and adjust as necessary.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="steps-in-kicad-to-add-load-capacitors">Steps in KiCad to Add Load Capacitors<a href="#steps-in-kicad-to-add-load-capacitors" class="hash-link" aria-label="Direct link to Steps in KiCad to Add Load Capacitors" title="Direct link to Steps in KiCad to Add Load Capacitors" translate="no">​</a></h3>
<ol>
<li class="">
<p>Add Capacitors:</p>
<ul>
<li class="">Select Add Symbol and search for &quot;capacitor&quot;.</li>
</ul>
</li>
<li class="">
<p>Choose Appropriate Capacitors:</p>
<ul>
<li class="">Select capacitors with the calculated value (e.g., 2.5 pF or 3 pF).</li>
</ul>
</li>
<li class="">
<p>Place Capacitors on the Schematic:</p>
<ul>
<li class="">Position one capacitor connected to HSE_IN.</li>
<li class="">Position the second capacitor connected to HSE_OUT.</li>
</ul>
</li>
<li class="">
<p>Connect to Ground:</p>
<ul>
<li class="">Ensure the other ends of both capacitors are connected to GND.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="crystal-circuit-without-feedback-resistor">Crystal Circuit Without Feedback Resistor<a href="#crystal-circuit-without-feedback-resistor" class="hash-link" aria-label="Direct link to Crystal Circuit Without Feedback Resistor" title="Direct link to Crystal Circuit Without Feedback Resistor" translate="no">​</a></h3>
<ul>
<li class="">
<p>Simplified Design:</p>
<ul>
<li class="">Omit the feedback resistor unless specific conditions necessitate its inclusion.</li>
</ul>
</li>
<li class="">
<p>Advantages:</p>
<ul>
<li class="">Reduced component count.</li>
<li class="">Simplified routing and potentially lower cost.</li>
</ul>
</li>
<li class="">
<p>Verification:</p>
<ul>
<li class="">Consult AN2867 to confirm that omitting the feedback resistor is suitable for your specific application.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-connecting-the-crystal-in-kicad">6. Connecting the Crystal in KiCad<a href="#6-connecting-the-crystal-in-kicad" class="hash-link" aria-label="Direct link to 6. Connecting the Crystal in KiCad" title="Direct link to 6. Connecting the Crystal in KiCad" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="steps-to-connect-the-crystal-to-the-stm32">Steps to Connect the Crystal to the STM32<a href="#steps-to-connect-the-crystal-to-the-stm32" class="hash-link" aria-label="Direct link to Steps to Connect the Crystal to the STM32" title="Direct link to Steps to Connect the Crystal to the STM32" translate="no">​</a></h3>
<ol>
<li class="">
<p>Connect Pin 1 of the Crystal:</p>
<ul>
<li class="">Link to the HSE_IN pin (PD0) on the STM32 microcontroller.</li>
</ul>
</li>
<li class="">
<p>Connect Pin 3 of the Crystal:</p>
<ul>
<li class="">Link to the HSE_OUT pin (PD1) on the STM32 microcontroller.</li>
</ul>
</li>
<li class="">
<p>Ground Pins 2 and 4 (Four-Pin Package):</p>
<ul>
<li class="">Connect to GND to minimize noise interference and enhance stability.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="routing-and-naming-the-net-labels">Routing and Naming the Net Labels<a href="#routing-and-naming-the-net-labels" class="hash-link" aria-label="Direct link to Routing and Naming the Net Labels" title="Direct link to Routing and Naming the Net Labels" translate="no">​</a></h3>
<ul>
<li class="">
<p>Net Labeling:</p>
<ul>
<li class="">Assign clear and consistent net labels to facilitate PCB layout and troubleshooting.</li>
</ul>
</li>
<li class="">
<p>Recommended Labels:</p>
<ul>
<li class="">HSE_IN: For connections to the HSE_IN (OSC_IN) pin.</li>
<li class="">HSE_OUT: For connections to the HSE_OUT (OSC_OUT) pin.</li>
</ul>
</li>
<li class="">
<p>Schematic Clarity:</p>
<ul>
<li class="">Ensure that all connections are logically organized and labeled to prevent confusion during the PCB design phase.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-for-routing">Best Practices for Routing<a href="#best-practices-for-routing" class="hash-link" aria-label="Direct link to Best Practices for Routing" title="Direct link to Best Practices for Routing" translate="no">​</a></h3>
<ul>
<li class="">
<p>Minimize Trace Lengths:</p>
<ul>
<li class="">Keep traces between the crystal and STM32 pins as short as possible to reduce inductance and potential signal integrity issues.</li>
</ul>
</li>
<li class="">
<p>Avoid Routing Near High-Frequency Signals:</p>
<ul>
<li class="">Prevent interference by keeping the crystal circuit away from other high-speed or high-frequency signals on the PCB.</li>
</ul>
</li>
<li class="">
<p>Use Ground Planes:</p>
<ul>
<li class="">Implement ground planes to provide a low-impedance path for return currents, enhancing signal stability.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="7-reviewing-the-schematic-for-the-crystal-circuit">7. Reviewing the Schematic for the Crystal Circuit<a href="#7-reviewing-the-schematic-for-the-crystal-circuit" class="hash-link" aria-label="Direct link to 7. Reviewing the Schematic for the Crystal Circuit" title="Direct link to 7. Reviewing the Schematic for the Crystal Circuit" translate="no">​</a></h2>
<p>After integrating all components, it is crucial to thoroughly review the schematic to ensure correctness and reliability.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="schematic-components-overview">Schematic Components Overview<a href="#schematic-components-overview" class="hash-link" aria-label="Direct link to Schematic Components Overview" title="Direct link to Schematic Components Overview" translate="no">​</a></h3>
<ul>
<li class="">
<p><code>crystal oscillator</code> :</p>
<ul>
<li class="">Connected between PD0 (HSE_IN) and PD1 (HSE_OUT) of the STM32.</li>
</ul>
</li>
<li class="">
<p>Load Capacitors:</p>
<ul>
<li class="">Two 10 pF capacitors connected from each crystal pin to GND.</li>
</ul>
</li>
<li class="">
<p>Grounded Pins (Two and Four):</p>
<ul>
<li class="">Grounded to reduce noise and enhance signal stability.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verification-checklist">Verification Checklist<a href="#verification-checklist" class="hash-link" aria-label="Direct link to Verification Checklist" title="Direct link to Verification Checklist" translate="no">​</a></h3>
<ol>
<li class="">
<p>Component Placement:</p>
<ul>
<li class="">Ensure all components (crystal, capacitors, resistors) are correctly placed and oriented.</li>
</ul>
</li>
<li class="">
<p>Net Connections:</p>
<ul>
<li class="">Confirm that all connections align with the intended net labels (e.g., HSE_IN, HSE_OUT).</li>
</ul>
</li>
<li class="">
<p>Value Accuracy:</p>
<ul>
<li class="">Verify that all component values, especially load capacitors, match the calculated requirements.</li>
</ul>
</li>
<li class="">
<p>Ground Connections:</p>
<ul>
<li class="">Check that all ground connections are properly routed and connected to the common ground plane.</li>
</ul>
</li>
<li class="">
<p>Symbol Accuracy:</p>
<ul>
<li class="">Ensure that the correct symbols (two-pin or four-pin crystal) are used based on the selected crystal package.</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="8-validating-the-crystal-circuit">8. Validating the Crystal Circuit<a href="#8-validating-the-crystal-circuit" class="hash-link" aria-label="Direct link to 8. Validating the Crystal Circuit" title="Direct link to 8. Validating the Crystal Circuit" translate="no">​</a></h2>
<p>Prior to proceeding to PCB layout and manufacturing, validate the <code>crystal oscillator</code>  circuit to prevent potential issues during operation.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="validation-steps">Validation Steps<a href="#validation-steps" class="hash-link" aria-label="Direct link to Validation Steps" title="Direct link to Validation Steps" translate="no">​</a></h3>
<ol>
<li class="">
<p>Check Net Names:</p>
<ul>
<li class="">Ensure all nets are labeled correctly and consistently (e.g., HSE_IN, HSE_OUT).</li>
</ul>
</li>
<li class="">
<p>Load Capacitor Verification:</p>
<ul>
<li class="">Cross-reference the calculated load capacitors with the crystal&#x27;s datasheet to ensure compliance.</li>
</ul>
</li>
<li class="">
<p>Ground Connections:</p>
<ul>
<li class="">Confirm that all ground connections for the crystal and capacitors are correctly routed and connected to the ground plane.</li>
</ul>
</li>
<li class="">
<p>Component Footprints:</p>
<ul>
<li class="">Verify that all components have the correct footprints assigned for PCB layout.</li>
</ul>
</li>
<li class="">
<p>Electrical Rules Check (ERC):</p>
<ul>
<li class="">Run ERC in KiCad to identify and rectify any schematic errors or connectivity issues.</li>
</ul>
</li>
<li class="">
<p>Peer Review:</p>
<ul>
<li class="">Have another engineer or team member review the schematic for additional verification.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting-common-issues">Troubleshooting Common Issues<a href="#troubleshooting-common-issues" class="hash-link" aria-label="Direct link to Troubleshooting Common Issues" title="Direct link to Troubleshooting Common Issues" translate="no">​</a></h3>
<ul>
<li class="">
<p>Oscillation Failure:</p>
<ul>
<li class="">Re-examine load capacitor values and connections.</li>
<li class="">Ensure that the crystal is compatible with the microcontroller.</li>
</ul>
</li>
<li class="">
<p>Noise and Interference:</p>
<ul>
<li class="">Improve grounding and shielding.</li>
<li class="">Adjust component placement to minimize electromagnetic interference.</li>
</ul>
</li>
<li class="">
<p>Incorrect Frequency:</p>
<ul>
<li class="">Double-check crystal specifications and load capacitor calculations.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h2>
<p>Integrating a <code>crystal oscillator</code>  into your STM32 microcontroller design is fundamental for achieving precise and stable timing, which is essential for high-speed communication protocols and other time-critical applications. By meticulously selecting and placing the <code>crystal oscillator</code>  and its associated components in KiCad, and adhering to the guidelines outlined in Application Note AN2867, you ensure a reliable and optimized design.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h3>
<ul>
<li class="">Symbol Selection: Choose the appropriate crystal symbol in KiCad based on the package type.</li>
<li class="">Load Capacitors: Accurately calculate and implement load capacitors to stabilize oscillation.</li>
<li class="">Schematic Integrity: Maintain clear and consistent net labeling and grounding practices.</li>
<li class="">Validation: Thoroughly review and validate the schematic to prevent design flaws.</li>
</ul>
<p>With a well-designed <code>crystal oscillator</code>  circuit, your STM32 microcontroller will operate with a stable and accurate clock source, enabling robust performance in high-speed and timing-sensitive applications.</p>
</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/02_Schematic/04_Crystal-Circuitry.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/Pin-Out_STM32CubeIDE"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Pinout Configuration and Peripheral Setup</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/STM32-HW-Design-with-KiCAD/docs/Schematic/USB"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Connecting USB Circuitry</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-role-of-the-crystal-oscillator-in-stm32-microcontrollers" class="table-of-contents__link toc-highlight">The Role of the Crystal Oscillator in STM32 Microcontrollers</a><ul><li><a href="#importance-of-a-precise-clock-source" class="table-of-contents__link toc-highlight">Importance of a Precise Clock Source</a></li><li><a href="#internal-vs-external-oscillators" class="table-of-contents__link toc-highlight">Internal vs. External Oscillators</a></li><li><a href="#typical-crystal-oscillator-circuit-components" class="table-of-contents__link toc-highlight">Typical Crystal Oscillator Circuit Components</a></li></ul></li><li><a href="#2-crystal-package-types-and-symbol-selection-in-kicad" class="table-of-contents__link toc-highlight">2. Crystal Package Types and Symbol Selection in KiCad</a><ul><li><a href="#crystal-oscillator-package-configurations" class="table-of-contents__link toc-highlight">Crystal Oscillator Package Configurations</a></li><li><a href="#selecting-the-crystal-symbol-in-kicad" class="table-of-contents__link toc-highlight">Selecting the Crystal Symbol in KiCad</a></li><li><a href="#pin-configuration-for-a-four-pin-crystal" class="table-of-contents__link toc-highlight">Pin Configuration for a Four-Pin Crystal</a></li></ul></li><li><a href="#understanding-the-crystal-circuit-design" class="table-of-contents__link toc-highlight">Understanding the Crystal Circuit Design</a><ul><li><a href="#built-in-microcontroller-features" class="table-of-contents__link toc-highlight">Built-in Microcontroller Features</a></li><li><a href="#external-components-required" class="table-of-contents__link toc-highlight">External Components Required</a></li><li><a href="#typical-crystal-oscillator-circuit-layout" class="table-of-contents__link toc-highlight">Typical Crystal Oscillator Circuit Layout</a></li><li><a href="#external-components-load-capacitors" class="table-of-contents__link toc-highlight">External Components: Load Capacitors</a></li></ul></li><li><a href="#4-application-note-an2867-oscillator-design-for-stm32" class="table-of-contents__link toc-highlight">4. Application Note AN2867: Oscillator Design for STM32</a><ul><li><a href="#key-guidelines-from-an2867" class="table-of-contents__link toc-highlight">Key Guidelines from AN2867</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a></li></ul></li><li><a href="#5-calculating-the-load-capacitor-values" class="table-of-contents__link toc-highlight">5. Calculating the Load Capacitor Values</a><ul><li><a href="#load-capacitor-calculation-formula" class="table-of-contents__link toc-highlight">Load Capacitor Calculation Formula</a></li><li><a href="#example-calculation" class="table-of-contents__link toc-highlight">Example Calculation</a></li><li><a href="#steps-in-kicad-to-add-load-capacitors" class="table-of-contents__link toc-highlight">Steps in KiCad to Add Load Capacitors</a></li><li><a href="#crystal-circuit-without-feedback-resistor" class="table-of-contents__link toc-highlight">Crystal Circuit Without Feedback Resistor</a></li></ul></li><li><a href="#6-connecting-the-crystal-in-kicad" class="table-of-contents__link toc-highlight">6. Connecting the Crystal in KiCad</a><ul><li><a href="#steps-to-connect-the-crystal-to-the-stm32" class="table-of-contents__link toc-highlight">Steps to Connect the Crystal to the STM32</a></li><li><a href="#routing-and-naming-the-net-labels" class="table-of-contents__link toc-highlight">Routing and Naming the Net Labels</a></li><li><a href="#best-practices-for-routing" class="table-of-contents__link toc-highlight">Best Practices for Routing</a></li></ul></li><li><a href="#7-reviewing-the-schematic-for-the-crystal-circuit" class="table-of-contents__link toc-highlight">7. Reviewing the Schematic for the Crystal Circuit</a><ul><li><a href="#schematic-components-overview" class="table-of-contents__link toc-highlight">Schematic Components Overview</a></li><li><a href="#verification-checklist" class="table-of-contents__link toc-highlight">Verification Checklist</a></li></ul></li><li><a href="#8-validating-the-crystal-circuit" class="table-of-contents__link toc-highlight">8. Validating the Crystal Circuit</a><ul><li><a href="#validation-steps" class="table-of-contents__link toc-highlight">Validation Steps</a></li><li><a href="#troubleshooting-common-issues" class="table-of-contents__link toc-highlight">Troubleshooting Common Issues</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a><ul><li><a href="#key-takeaways" class="table-of-contents__link toc-highlight">Key Takeaways</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/STM32-HW-Design-with-KiCAD/docs/category/introduction">Knowledge Base</a></li><li class="footer__item"><a class="footer__link-item" href="/STM32-HW-Design-with-KiCAD/docs/category/recipes">Recipes</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/CagriCatik/STM32-HW-Design-with-KiCAD" target="_blank" rel="noopener noreferrer" class="footer__link-item">Project 1<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/CagriCatik/STM32-HW-Design-with-KiCAD" target="_blank" rel="noopener noreferrer" class="footer__link-item">Project 2<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/CagriCatik/STM32-HW-Design-with-KiCAD" target="_blank" rel="noopener noreferrer" class="footer__link-item">Project 3<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/STM32-HW-Design-with-KiCAD/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/CagriCatik/STM32-HW-Design-with-KiCAD" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">STM32 Hardware Design with KiCAD</div></div></div></footer></div>
</body>
</html>